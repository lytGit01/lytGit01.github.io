---
title: 浏览器缓存
date: 2022-07-11
categories:
- browser
tags:
- browser
---

### cache缓存状态码

| 状态码                      | 描述                                                                   |
|--------------------------|----------------------------------------------------------------------|
| 200(from meomory cache)	 | 状态安为灰色不去请求服务器，直接获取内存资源，属于强制缓存                                        |
| 200(from disk cache)	    | 状态安为灰色不去请求服务器，直接获取磁盘资源，属于强制缓存                                        |
| 200                      | 	请求服务器，获取资源                                                          |
| 304(from disk cache)     | 	第一次请求request会返回if-None-Match，下次请求reposon携带Etag服务器会判断资源是否更新，未更新返回304 |


###  强制缓存/协商缓存
> 强制缓存就是，用户第一次访问页面之后，浏览器将数据存在缓存中，在过期时间之内，都不会再请求服务器。
> 是否使用强制缓存在于资源是否过期，该过期时间从第一次请求的服务器响应头中获取。如果在过期时间内，从缓存中读取，如果超出过期时间，则使用协商缓存（下面会讲）。

### Expires(http1)和Cache-Control(http1.1) 其中Cache-Control优先级比Expires高。
> 协商缓存，从字面意思，就是要协商，是浏览器和服务器协商，那么浏览器每次都要和服务器通信。
> 在第一次请求服务器时，服务器会返回资源，并且返回一个资源的缓存标识，一起存到浏览器的缓存数据库。
> 当第二次请求资源时，浏览器会首先将缓存标识发送给服务器，服务器拿到标识后判断标识是否匹配，
> 如果不匹配，表示资源有更新，服务器会将新数据和新的缓存标识一起返回到浏览器；如果缓存标识匹配，表示资源没有更新，并且返回 304 状态码，浏览器就读取本地缓存服务器中的数据。


#### Etag/if-None-Match  Last-Modified/IF-Modified-Since

### no-cache no-store
> no-cache就是不缓存，但是no-cache并不是不缓存，而是使用协商缓存，所以并不能禁止缓存，
> no-store才是真正的禁止缓存。从节省带宽角度讲，
> 使用no-cache更优一点，文件未发生改变时只传输很小的报文大小，只有在文件改变时才会传输整个文件大小。而不是no-store不管什么情况都传输整个文件大小。

### 如何设置协商缓存
```
location ~ .*\.(html)$ {  // 对html文件限制缓存

    add_header Cache-Control no-store;  // 不缓存

    // 或者用add_header Cache-Control no-cache;替代上面那一句，协商缓存

    add_header Pragma no-cache;

}
```

### cache-control 介绍

| Cache-directive	                                                                                                    | 说明                                                                                                         |
|---------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|
| public	| 所有内容都将被缓存(客户端和代理服务器都可缓存)                                                                                   |                                                                              
| private	| 内容只缓存到私有缓存中(仅客户端可以缓存，代理服务器不可缓存)                                                                            |                                                                          
| no-cache	| 必须先与服务器确认返回的响应是否被更改，然后才能使用该响应来满足后续对同一个网址的请求。因此，如果存在合适的验证令牌 (ETag)，no-cache 会发起往返通信来验证缓存的响应，如果资源未被更改，可以避免下载 |
| no-store	| 所有内容都不会被缓存到缓存或 Internet 临时文件中                                                                              |
| must-revalidation/proxy-revalidation	| 如果缓存的内容失效，请求必须发送到服务器/代理以进行重新验证                                                                             |             
| max-age=xxx (xxx is numeric)	| 缓存的内容将在 xxx 秒后失效, 这个选项只在HTTP 1.1可用, 并如果和Last-Modified一起使用时, 优先级较高                                          |               
